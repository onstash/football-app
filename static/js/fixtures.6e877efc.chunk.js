webpackJsonp([9],{214:function(e,t,a){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=a(2),u=a(10),m=a(0),l=a(6),s=a(11),c=function(){function e(e,t){var a=[],r=!0,n=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(r=(o=u.next()).done)&&(a.push(o.value),!t||a.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(n)throw i}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),p=function(){return a.e(3).then(a.bind(null,86))},d=function(){return a.e(13).then(a.bind(null,206))},h=function(){return o.a.createElement("div",{className:"fa-fixtures-error"},"No fixtures for selected time period, Master Wayne.")},F=function(e){var t=e.fixtures,a=e.timeFrame,r=e.team;e.dayFixtures;return 0===Object.keys(t).length?o.a.createElement(h,null):o.a.createElement("div",{className:"fa-fixtures"},Object.keys(t).map(function(e){var n=t[e];return o.a.createElement(s.a,{loadComponentModule:d,componentProps:{key:e,timeFrame:a,team:r,fixtureDay:e,fixtures:n},componentName:"DayFixtures"})}))},v=function(e){var t={},a={};return e.forEach(function(e){var r=e.matchday,n=e.status,i="FINISHED"===n?t:a;i[r]?i[r].push(e):i[r]=[e]}),{oldFixtures:t,upcomingFixtures:a}},x=function(e){function t(){r(this,t);var e=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={loading:!1,oldFixtures:{},upcomingFixtures:{},timeFrame:"n14",timeFrameLabel:"Next week",fixtureFilters:[{label:"Upcoming fixtures",timeFrame:"n14"},{label:"Recently concluded fixtures",timeFrame:"p7"}],allTeams:{},teams:[],team:null,teamID:null},e._fetchCompetitionFixturesData=e.fetchCompetitionFixturesData.bind(e),e._filterCompetitionFixtures=e.filterCompetitionFixtures.bind(e),e.mounted=!1,e}return i(t,e),f(t,[{key:"fetchCompetitionFixturesData",value:function(e){var t=this,a=e.competitionID,r=e.timeFrame,n=e.team;if(a&&r){this.mounted&&this.setState(function(){return{loading:!0}});var i=u.a.fetchCompetitionFixtures(a,r),o=u.a.fetchCompetitionTeams(a);Promise.all([i,o]).then(function(e){var i=c(e,2),o=i[0],u=i[1],s=u.data.teams,f={},p=[{label:"All teams",value:"all-teams"}];s.forEach(function(e){var t=e.name,a=e._links.self.href,r=a.split("/"),n=r[r.length-1];f[""+n]=t,p.push({label:t,value:n})});var d=o.data,h=d.fixtures;m.a.get(m.a.keys.MIXPANEL_DISTINCT_ID).then(function(e){var i={id:a,name:t.props.name,timeFrame:r,currentTeam:n||"All Teams"};l.a.track(e,"Fixtures Viewed",i)}).catch(console.error);var F=v(h),x=F.oldFixtures,y=F.upcomingFixtures;t.mounted&&t.setState(function(){return{loading:!1,oldFixtures:x,upcomingFixtures:y,teams:p,allTeams:f}})}).catch(function(e){t.mounted&&t.setState(function(){return{loading:!1,oldFixtures:{},upcomingFixtures:{},teams:[],allTeams:[]}})})}}},{key:"filterCompetitionFixtures",value:function(e){var t=this,a=e.competitionID,r=e.newTimeFrame,n=e.timeFrameLabel;u.a.fetchCompetitionFixtures(a,r).then(function(e){var i=e.data,o=i.fixtures,u=t.state.team;m.a.get(m.a.keys.MIXPANEL_DISTINCT_ID).then(function(e){var n={id:a,name:t.props.name,timeFrame:r,currentTeam:u||"All Teams",filter:"TimeFrame"};l.a.track(e,"Fixtures Filtered",n)}).catch(console.error);var s=v(o),c=s.oldFixtures,f=s.upcomingFixtures;t.mounted&&t.setState(function(){return{loading:!1,oldFixtures:c,upcomingFixtures:f,timeFrame:r,timeFrameLabel:n}})}).catch(function(e){t.mounted&&t.setState(function(){return{loading:!1,timeFrame:r,timeFrameLabel:n}})})}},{key:"componentDidMount",value:function(){this.mounted=!0;var e=this.state,t=e.timeFrame,a=e.team,r=this.props.id;this._fetchCompetitionFixturesData({competitionID:r,timeFrame:t,team:a})}},{key:"componentWillReceiveProps",value:function(e){var t=e.id;if(t!==this.props.id){var a=this.state,r=a.timeFrame,n=a.team;this._fetchCompetitionFixturesData({competitionID:t,timeFrame:r,team:n})}}},{key:"handleTimeFrameSelection",value:function(e){e.preventDefault();var t=e.target.value,a=void 0;switch(t){case"p7":a="Recently concluded fixtures";break;case"n14":a="Upcoming fixtures"}if(t!==this.state.timeFrame){var r=this.props.id;this._filterCompetitionFixtures({competitionID:r,newTimeFrame:t,timeFrameLabel:a})}}},{key:"handleTeamSelection",value:function(e){var t=this;e.preventDefault();var a=e.target.value,r=this.state,n=r.team,i=r.allTeams,o=i[a];n!==o&&(m.a.get(m.a.keys.MIXPANEL_DISTINCT_ID).then(function(e){var a=t.state.timeFrame,r={id:t.props.match.params.id,timeFrame:a,currentTeam:o||"All Teams",filter:"Team"};l.a.track(e,"Fixtures Filtered",r)}).catch(console.error),this.mounted&&this.setState(function(){return{team:o}}))}},{key:"render",value:function(){var e=this,t=this.state,a=t.loading,r=t.upcomingFixtures,n=t.oldFixtures,i=t.timeFrame,u=t.fixtureFilters,m=t.teams,l=t.team;if(a)return o.a.createElement(s.a,{loadComponentModule:p,componentName:"PlaceholderFixtures"});var c=-1===i.indexOf("n")?n:r;return o.a.createElement("div",{className:"fa-fixtures-container"},o.a.createElement("h2",{className:"fa-fixtures-heading"},"Fixtures"),o.a.createElement("div",{className:"fa-fixtures-filter"},o.a.createElement("select",{className:"fa-fixtures-time-filter",onChange:function(t){return e.handleTimeFrameSelection(t)}},u.map(function(e,t){var a=e.label,r=e.timeFrame;return o.a.createElement("option",{value:r,key:t},a)})),o.a.createElement("select",{className:"fa-fixtures-team-filter",onChange:function(t){return e.handleTeamSelection(t)}},m.map(function(e,t){var a=e.label,r=e.value;return o.a.createElement("option",{value:r,key:t},a)}))),o.a.createElement(F,{fixtures:c,timeFrame:i,team:l,dayFixtures:!0}))}}]),t}(o.a.Component);t.default=x}});
//# sourceMappingURL=fixtures.6e877efc.chunk.js.map